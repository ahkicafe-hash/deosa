<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="images/logo-light.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Directory | De'Osa Luxury Catering</title>

    <!-- Preload ElevenLabs SDK so it's cached before the user taps the voice button -->
    <link rel="modulepreload" href="https://cdn.jsdelivr.net/npm/@elevenlabs/client@0.14.0/+esm" crossorigin>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cream: '#FDFBF7',
                        charcoal: '#1C1C1C',
                        gold: '#C5A059',
                        'gold-light': '#E8D3A2',
                        earth: '#8B7355',
                        sand: '#F4F1EA'
                    },
                    fontFamily: {
                        serif: ['"Cormorant Garamond"', 'serif'],
                        sans: ['Montserrat', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style>
        :root {
            --cream: #FDFBF7;
            --charcoal: #1C1C1C;
            --gold: #C5A059;
        }

        body {
            background-color: var(--cream);
            color: var(--charcoal);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--cream); }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 4px; }

        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background: transparent;
            background-image: url("data:image/svg+xml;utf8,<svg fill='%231C1C1C' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>");
            background-repeat: no-repeat;
            background-position-x: 100%;
            background-position-y: center;
            padding-right: 2rem;
        }

        .img-texture::after {
            content: "";
            position: absolute;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 10;
        }

        .category-link.active {
            color: var(--charcoal);
            font-weight: 500;
        }
        .category-link.active::before {
            content: "";
            position: absolute;
            left: -1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 2px;
            background-color: var(--charcoal);
        }

        .ai-live-glow {
            box-shadow: 0 0 15px 5px rgba(197, 160, 89, 0.4);
            animation: pulse-glow 1.5s infinite alternate;
        }
        @keyframes pulse-glow {
            from { box-shadow: 0 0 10px 2px rgba(197, 160, 89, 0.4); }
            to { box-shadow: 0 0 25px 8px rgba(197, 160, 89, 0.8); }
        }
        .ai-bar {
            animation: sound-bounce 0.8s infinite ease-in-out alternate;
        }
        .ai-bar:nth-child(1) { animation-delay: 0.1s; }
        .ai-bar:nth-child(2) { animation-delay: 0.3s; }
        .ai-bar:nth-child(3) { animation-delay: 0.0s; }
        .ai-bar:nth-child(4) { animation-delay: 0.2s; }
        @keyframes sound-bounce {
            0% { height: 6px; opacity: 0.5; }
            100% { height: 20px; opacity: 1; }
        }

        /* Voice spotlight — warm golden pulse fired once when Elizabeth mentions a dish */
        @keyframes menu-spotlight {
            0%   { background-color: rgba(197, 160, 89, 0); }
            18%  { background-color: rgba(197, 160, 89, 0.22); }
            55%  { background-color: rgba(197, 160, 89, 0.12); }
            100% { background-color: rgba(197, 160, 89, 0); }
        }
        .menu-item-spotlight {
            animation: menu-spotlight 2.6s ease-out forwards;
        }
    </style>
</head>
<body class="selection:bg-gold selection:text-white pb-32">

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-40 transition-all duration-500 py-6 px-8 bg-cream/95 backdrop-blur-md border-b-2 border-charcoal/10 flex justify-between items-center shadow-sm" id="navbar">
        <a href="index.html"><img src="images/logo-light.svg" class="h-9 w-auto" alt="De'Osa"></a>
        <div class="hidden md:flex gap-8 font-sans text-sm tracking-widest uppercase">
            <a href="index.html" class="hover:text-gold transition-colors text-charcoal">Home</a>
            <a href="catering.html" class="text-gold transition-colors">Catering</a>
            <a href="story.html" class="hover:text-gold transition-colors text-charcoal">About</a>
            <a href="gallery.html" class="hover:text-gold transition-colors text-charcoal">Gallery</a>
            <a href="contact.html" class="hover:text-gold transition-colors text-charcoal">Contact</a>
            <a href="login.html" class="hover:text-gold transition-colors text-charcoal">Login</a>
        </div>
        <button id="mobile-menu-btn" onclick="toggleMobileMenu()" class="md:hidden font-sans text-sm tracking-widest uppercase text-charcoal">Menu</button>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="fixed inset-0 z-50 flex flex-col transition-all duration-500 opacity-0 pointer-events-none overflow-hidden" style="background-color:#1C1C1C;">
        <!-- Noise texture -->
        <div class="absolute inset-0 pointer-events-none" style="background-image:url('data:image/svg+xml,%3Csvg viewBox=%220 0 200 200%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cfilter id=%22n%22%3E%3CfeTurbulence type=%22fractalNoise%22 baseFrequency=%220.65%22 numOctaves=%223%22 stitchTiles=%22stitch%22/%3E%3C/filter%3E%3Crect width=%22100%25%22 height=%22100%25%22 filter=%22url(%23n)%22 opacity=%220.06%22/%3E%3C/svg%3E');"></div>
        <!-- Top gold accent line -->
        <div class="absolute top-0 left-0 right-0 h-px" style="background:linear-gradient(to right,transparent,#C5A059,transparent);"></div>

        <!-- Header -->
        <div class="relative z-10 flex justify-between items-center px-6 py-6" style="border-bottom:1px solid rgba(253,251,247,0.06);">
            <a href="index.html"><img src="images/logo-dark-bg.svg" class="h-9 w-auto" alt="De'Osa"></a>
            <button onclick="toggleMobileMenu()" class="w-10 h-10 flex items-center justify-center rounded-sm transition-colors" style="border:1px solid rgba(253,251,247,0.12);color:rgba(253,251,247,0.5);">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>

        <!-- Nav Links -->
        <div class="relative z-10 flex flex-col px-6 pt-10 flex-1">
            <p class="font-sans text-xs font-bold tracking-[0.3em] uppercase mb-8" style="color:#C5A059;">Navigation</p>

            <a href="index.html" class="group flex items-center justify-between py-5" style="border-bottom:1px solid rgba(253,251,247,0.07);">
                <span class="font-serif text-3xl" style="color:rgba(253,251,247,0.9);">Home</span>
                <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color:rgba(253,251,247,0.2);"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7"/></svg>
            </a>
            <a href="catering.html" class="group flex items-center justify-between py-5" style="border-bottom:1px solid rgba(253,251,247,0.07);">
                <span class="font-serif text-3xl" style="color:rgba(253,251,247,0.9);">Catering</span>
                <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color:rgba(253,251,247,0.2);"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7"/></svg>
            </a>
            <a href="story.html" class="group flex items-center justify-between py-5" style="border-bottom:1px solid rgba(253,251,247,0.07);">
                <span class="font-serif text-3xl" style="color:rgba(253,251,247,0.9);">Our Story</span>
                <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color:rgba(253,251,247,0.2);"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7"/></svg>
            </a>
            <a href="gallery.html" class="group flex items-center justify-between py-5" style="border-bottom:1px solid rgba(253,251,247,0.07);">
                <span class="font-serif text-3xl" style="color:rgba(253,251,247,0.9);">Gallery</span>
                <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color:rgba(253,251,247,0.2);"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7"/></svg>
            </a>
            <a href="contact.html" class="group flex items-center justify-between py-5" style="border-bottom:1px solid rgba(253,251,247,0.07);">
                <span class="font-serif text-3xl" style="color:rgba(253,251,247,0.9);">Contact</span>
                <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color:rgba(253,251,247,0.2);"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7"/></svg>
            </a>
            <a href="login.html" class="group flex items-center justify-between py-5">
                <span class="font-serif text-3xl" style="color:rgba(253,251,247,0.9);">Login</span>
                <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color:rgba(253,251,247,0.2);"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7"/></svg>
            </a>
        </div>

        <!-- Footer -->
        <div class="relative z-10 px-6" style="padding-bottom: calc(2.5rem + env(safe-area-inset-bottom, 0px));">
            <p class="font-sans text-xs tracking-widest uppercase" style="color:rgba(253,251,247,0.18);">Luxury African & Caribbean Catering · London</p>
        </div>
    </div>

    <!-- Header & Configuration -->
    <header class="pt-32 pb-6 md:pb-12 px-6 md:px-12 max-w-7xl mx-auto">
        <div class="text-center max-w-3xl mx-auto mb-6 md:mb-12 fade-in-up">
            <h1 class="font-serif text-5xl md:text-6xl text-charcoal mb-6">Curated Menus</h1>
            <p class="font-sans font-light text-charcoal">Select your venue, estimate your guest count, and curate your bespoke dining experience from our authentic, internationally recognized directory.</p>
        </div>

        <!-- Filters & Controls -->
        <div class="bg-sand p-4 md:p-8 grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 justify-between items-start border border-charcoal/10 fade-in-up">

            <!-- Venue -->
            <div class="w-full">
                <label class="block font-sans text-xs uppercase tracking-widest text-charcoal font-bold mb-2">Select Venue</label>
                <select id="venue-select" class="w-full border-b border-charcoal/20 py-3 focus:outline-none focus:border-gold font-serif text-xl font-medium text-charcoal cursor-pointer">
                    <option value="" disabled selected>Choose location...</option>
                </select>
            </div>

            <!-- Guest Count -->
            <div class="w-full">
                <label class="block font-sans text-xs uppercase tracking-widest text-charcoal font-bold mb-2">Number of People</label>
                <select id="guest-count" class="w-full border-b border-charcoal/20 py-3 focus:outline-none focus:border-gold font-serif text-xl font-medium text-charcoal cursor-pointer">
                    <option value="10">Intimate (1 - 10 Guests)</option>
                    <option value="20">Gathering (10 - 20 Guests)</option>
                    <option value="30">Celebration (20 - 30 Guests)</option>
                    <option value="50">Banquet (30 - 50 Guests)</option>
                    <option value="100">Grand (50 - 100 Guests)</option>
                    <option value="200">Gala (100 - 200 Guests)</option>
                    <option value="300">Majestic (200 - 300+ Guests)</option>
                </select>
            </div>

            <!-- Waiter Service -->
            <div class="w-full">
                <label class="block font-sans text-xs uppercase tracking-widest text-charcoal font-bold mb-2">Waiter Service <span class="normal-case text-charcoal/60">(Optional)</span></label>
                <div class="flex items-center justify-between border-b border-charcoal/20 py-3">
                    <span id="waiter-label" class="font-serif text-xl font-medium" style="color: rgba(28,28,28,0.7);">Add to your package</span>
                    <button id="waiter-toggle" onclick="toggleWaiters()" class="relative w-12 h-6 rounded-full transition-colors duration-300 focus:outline-none flex items-center shrink-0" style="background-color: rgba(28,28,28,0.15);">
                        <span id="waiter-knob" class="absolute left-1 w-4 h-4 bg-white rounded-full shadow transition-transform duration-300"></span>
                    </button>
                </div>
                <div id="waiter-options" class="hidden mt-4 pb-2 space-y-2">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-serif text-xl font-medium text-charcoal" id="waiter-count-display">1 waiter</p>
                            <p class="font-sans text-[10px] text-charcoal/80 font-medium mt-0.5" id="waiter-min-note">Included for up to 20 guests</p>
                        </div>
                        <p class="font-serif text-xl font-light text-gold" id="waiter-subtotal">Free</p>
                    </div>
                    <p class="font-sans text-[10px] text-charcoal/80 font-medium">+£150 per 10 guests above 20</p>
                </div>
            </div>

            <!-- Search -->
            <div class="w-full">
                <label class="block font-sans text-xs uppercase tracking-widest text-charcoal font-bold mb-2">Search Menu</label>
                <input type="text" id="search-input" placeholder="e.g. Jollof, Chicken..." class="w-full bg-transparent border-b border-charcoal/20 py-3 focus:outline-none focus:border-gold font-serif text-xl font-medium text-charcoal placeholder:text-charcoal/50">
            </div>

            <!-- Course Filter -->
            <div class="w-full">
                <label class="block font-sans text-xs uppercase tracking-widest text-charcoal font-bold mb-2">Filter by Course</label>
                <select id="type-filter" class="w-full border-b border-charcoal/20 py-3 focus:outline-none focus:border-gold font-serif text-xl font-medium text-charcoal cursor-pointer">
                    <option value="all">All Courses</option>
                    <option value="starters">Starters & Appetizers</option>
                    <option value="mains">Main Courses</option>
                    <option value="sides">Sides & Extras</option>
                    <option value="desserts">Desserts</option>
                    <option value="canapés">Canapés</option>
                    <option value="specials">Specials</option>
                </select>
            </div>
        </div>
    </header>

    <!-- Directory Layout -->
    <main class="max-w-7xl mx-auto px-6 md:px-12 flex flex-col md:flex-row gap-0 md:gap-16 relative">

        <!-- Sidebar Navigation (Sticky) -->
        <aside class="w-full md:w-1/4 hidden md:block">
            <div class="sticky top-32 space-y-8 bg-cream border-r border-charcoal/10 pr-6 py-4">
                <div>
                    <h3 class="font-sans text-xs font-light uppercase tracking-[0.2em] text-charcoal mb-6 border-b border-charcoal/20 pb-2">Menu Categories</h3>
                    <ul class="space-y-4 font-serif text-xl text-charcoal">
                        <li class="relative"><a href="#cat-african" class="category-link active hover:text-charcoal transition-colors block">African Heritage</a></li>
                        <li class="relative"><a href="#cat-caribbean" class="category-link hover:text-charcoal transition-colors block">Caribbean Cuisine</a></li>
                        <li class="relative"><a href="#cat-canapes" class="category-link hover:text-charcoal transition-colors block">Luxury Canapés</a></li>
                    </ul>
                </div>
            </div>
        </aside>

        <!-- Menu Content -->
        <div class="w-full md:w-3/4" id="menu-container"></div>

        <!-- Empty State -->
        <div id="no-results-msg" class="w-full md:w-3/4 hidden flex-col items-center justify-center py-20 text-center">
            <h3 class="font-serif text-3xl text-charcoal mb-4">No dishes found</h3>
            <p class="font-sans text-charcoal font-light">Try adjusting your search or course filter to see more options.</p>
            <button onclick="clearFilters()" class="mt-6 px-6 py-2 border border-charcoal/40 text-charcoal/60 font-sans font-light text-xs uppercase tracking-widest hover:bg-charcoal hover:text-cream transition-colors">Clear Filters</button>
        </div>
    </main>

    <!-- Floating Cart / Summary -->
    <div id="cart-drawer" class="fixed bottom-0 right-0 md:right-8 md:bottom-8 w-full md:w-[300px] bg-charcoal text-cream shadow-2xl border border-gold/50 z-[60] transition-transform duration-500 rounded-t-xl md:rounded-xl overflow-hidden" style="transform: translateY(150%)">

        <!-- Header — click to expand/collapse -->
        <div id="cart-header" onclick="toggleCartExpand()" class="px-5 py-3 flex justify-between items-center cursor-pointer select-none">
            <div class="flex items-center gap-2.5">
                <h3 class="font-serif text-sm font-light text-gold tracking-widest">Your Selection</h3>
                <span id="cart-count" class="font-sans font-light text-[10px] tracking-widest bg-gold/80 text-charcoal px-2 py-0.5 rounded-sm">0 items</span>
            </div>
            <div class="flex items-center gap-2.5">
                <span id="cart-total-mini" class="font-serif text-sm font-bold text-gold">£0</span>
                <svg id="cart-arrow" class="w-3.5 h-3.5 text-gold/70 transition-transform duration-300 rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 15l7-7 7 7"/>
                </svg>
            </div>
        </div>

        <!-- Expandable body -->
        <div id="cart-body" class="hidden border-t border-cream/10">
            <div id="cart-items" class="px-4 py-2 space-y-0 overflow-y-auto" style="max-height: 186px">
                <p class="text-cream/40 italic text-xs py-2">No dishes selected yet.</p>
            </div>
            <div class="px-4 py-3 border-t border-cream/10">
                <div class="flex justify-between items-center mb-3">
                    <span class="font-sans text-[10px] font-light uppercase tracking-widest text-cream/40">Estimated Total</span>
                    <span id="cart-total" class="font-serif text-lg font-bold text-gold">£0</span>
                </div>
                <button class="w-full py-2.5 bg-gold text-charcoal font-sans font-light uppercase tracking-widest text-xs hover:bg-white transition-colors duration-300">
                    Request Quote
                </button>
                <p class="text-[9px] text-cream/30 text-center mt-2 font-semibold uppercase tracking-wider">Prices reflect selected guest tier</p>
            </div>
        </div>
    </div>

    <!-- AI Voice Assistant FAB -->
    <button id="ai-voice-btn" onclick="toggleAIVoice()" class="fixed bottom-6 left-4 md:bottom-12 md:left-12 w-12 h-12 md:w-16 md:h-16 transition-all duration-500 bg-charcoal border-2 border-gold rounded-full shadow-2xl z-50 flex items-center justify-center transition-all duration-300 group hover:scale-105">
        <svg id="ai-idle-icon" class="w-6 h-6 md:w-7 md:h-7 text-gold transition-opacity duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
        </svg>
        <div id="ai-live-icon" class="hidden absolute inset-0 items-center justify-center gap-1 md:gap-1.5 transition-opacity duration-300">
            <div class="w-1 md:w-1.5 bg-gold rounded-full ai-bar"></div>
            <div class="w-1 md:w-1.5 bg-gold rounded-full ai-bar"></div>
            <div class="w-1 md:w-1.5 bg-gold rounded-full ai-bar"></div>
            <div class="w-1 md:w-1.5 bg-gold rounded-full ai-bar"></div>
        </div>
    </button>

    <!-- GSAP & Lenis -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <script>
        const venues = [
            "8 Northumberland Avenue", "Battersea Arts Centre – London", "Beecham House", "Bexleyheath Marriott Hotel",
            "Boreham House", "Braxted Park", "Brewers Hall – London", "Chelsea Harbour Hotel", "Chigwell Marquees",
            "Churchill Hyatt Regency", "De Vere Grand Connaught Rooms", "Double tree by Hilton Dartford",
            "Double tree by Hilton Ealing Common", "DoubleTree by Hilton Hotel London – Docklands Riverside",
            "Ealing Town Hall", "Epsom Down Racecourse", "Froyle Park", "Grand Sapphire Croydon", "Hylands House",
            "Hunton Park", "ILEC Conference Centre", "Marriott Hotel", "Meridian Grand", "Millennium Mayfair",
            "North Mymms", "Oatlands Park Hotel Weybridge", "Old Thorns Hotel Liphook", "Pendley Manor Hotel",
            "Plaisterers Hall", "Porchester Hall – Queensway London", "Royal Garden Hotel", "Royal Horticultural Halls – Lindley Hall",
            "Selsdon Park Hotel & Golf Club", "Shendish Manor", "Shoreditch Town Hall – London", "Syon Park, The Garden Room",
            "The Conservatory Painshill Park", "The Jetty Greenwich", "The Manor At Bickley, Bromley", "The Principality London",
            "The Waldorf Hilton, London", "The Willows", "Thistle Marble Arch", "Three Rivers Golf and Country Club", "Trinity Buoy Wharf – London"
        ];

        const menuData = [
            {
                id: "cat-african",
                categoryTitle: "African Heritage",
                subcategories: [
                    {
                        title: "Starters",
                        basePrice: 8,
                        items: ["Puff Puff", "Moyin Moyin", "Spicy gizzard", "Spicy Shish Kebab", "Fried Plantain & Smoked Salmon Sticks", "Assorted Meat or Fish pepper soup", "Spring Rolls Served with sauce", "Fermented oil bean seed (Ugba)", "Crispy Breaded King Prawns", "Cooked prawns, on a bed of lettuce", "Chicken wings drizzled with warm spicy barbecue sauce"]
                    },
                    {
                        title: "Nigerian Mains",
                        basePrice: 22,
                        items: [
                            "Jollof, Fried, Coconut or White Rice (w/ Plantain & Meat/Fish)",
                            "Egusi, Eforiro, Ewedu, Ogbono, Edikaikong or Banga Soup",
                            "Semolina, Pounded Yam, Garri, Amala or Ground Rice",
                            "Roasted Potatoes (Served with Roasted Lamb, Chicken or Turkey)",
                            "Boiled Yam and Tomato Omelette",
                            "Dodo (Fried Plantain) with Omelette",
                            "Asaro (Yam Porridge) and Dodo"
                        ]
                    },
                    {
                        title: "Ghanaian Mains",
                        basePrice: 22,
                        items: [
                            "Banku (Served with Okro Soup)",
                            "Kelewele (Spiced diced fried soft plantain)",
                            "Fufu (Served with Groundnut Soup)",
                            "Jollof Rice (Ghanaian-style)",
                            "Kenkey (Fermented corn balls)",
                            "Omo Tuo (Mashed rice balls with Sauce)",
                            "Waakye (Rice and beans with Stew)",
                            "Yam 'Ampesi' (Boiled yam with DOsa Sauce)",
                            "Shito Chicken Stew / Chicken Curry",
                            "Goat Curry / Beef Stew / Beef Curry",
                            "Fish Stew / Fish Curry (Croaker) / Red Snapper or Tilapia"
                        ]
                    },
                    {
                        title: "Sierra Leonean Mains",
                        basePrice: 22,
                        items: [
                            "Jollof Rice & stew with choice of meat",
                            "Boneless chicken fried rice / Seafood fried rice",
                            "Rice Sticks with choice of seafood, chicken or meat",
                            "Groundnut stew served with steamed rice",
                            "Cassava leaves with choice of meat/fish cooked in palm oil",
                            "Crain Crain with choice of meat/fish",
                            "Potato leaves with choice meat/fish",
                            "Red palm oil stew with 'check rice'",
                            "Fufu served with choice of soup (Palm oil, Crain Crain)"
                        ]
                    },
                    {
                        title: "Desserts",
                        basePrice: 7,
                        items: ["Fresh tropical fruit salad", "Banana cake and Ice cream", "Chocolate Gateau", "Apple Pie with ice cream"]
                    }
                ]
            },
            {
                id: "cat-caribbean",
                categoryTitle: "Caribbean Cuisine",
                subcategories: [
                    {
                        title: "Main Menu",
                        basePrice: 20,
                        items: ["Jerk Chicken", "Jerk Chicken Wings", "Jerk Pork", "Curried Chicken", "Brown Stew Chicken", "Oxtail", "Pepper Steak", "Curry Goat", "Stew Shrimp", "Brown Stew Fish", "Escovitch Fish", "Curry Shrimp"]
                    },
                    {
                        title: "Specials",
                        basePrice: 24,
                        items: ["Callaloo", "Ackee & Cod Fish (Served with Steamed Vegetable, Rice and Peas or White Rice)"]
                    },
                    {
                        title: "Sides",
                        basePrice: 5,
                        items: ["Plantains", "Fried Dumpling", "Wings"]
                    },
                    {
                        title: "Desserts",
                        basePrice: 7,
                        items: ["Rum Cake", "Banana Cake", "Chocolate Cake", "Ice Creams"]
                    }
                ]
            },
            {
                id: "cat-canapes",
                categoryTitle: "Luxury Canapés",
                subcategories: [
                    {
                        title: "Bite-sized Elegance",
                        basePrice: 4,
                        items: [
                            "Ackee and saltfish vol au vent", "Jerk chicken skewer and plantain with sweet pepper",
                            "Fried Yam and Plantain Mix with Spicy Sauce", "Spring Rolls Served with Sweet Chilli Sauce",
                            "Crispy Breaded King Prawns", "Mini British Fish and Chips", "Cooked prawns, on a bed of lettuce",
                            "Chicken wings drizzled with warm spicy barbecue sauce", "Crispy-fried pieces of chicken dipped in delectable butter mayonnaise",
                            "Spicy gizzard and diced Plantains", "Mini Burgers", "Mini Mixed Meat Pies", "Mini Mixed Patties", "Puff Puff Bites"
                        ]
                    }
                ]
            }
        ];

        // --- STATE ---
        let currentGuestMultiplier = 10;
        let cart = [];

        // Waiter state
        let waitersEnabled = false;
        const waiterCountByGuest = { 10: 1, 20: 2, 30: 3, 50: 4, 100: 6, 200: 10, 300: 15 };
        function getWaiterCost() {
            return Math.max(0, Math.floor((currentGuestMultiplier - 20) / 10)) * 150;
        }

        // --- DOM ELEMENTS ---
        const venueSelect = document.getElementById('venue-select');
        const guestSelect = document.getElementById('guest-count');
        const searchInput = document.getElementById('search-input');
        const typeFilter = document.getElementById('type-filter');
        const menuContainer = document.getElementById('menu-container');
        const noResultsMsg = document.getElementById('no-results-msg');
        const cartDrawer = document.getElementById('cart-drawer');
        const cartItemsContainer = document.getElementById('cart-items');
        const cartTotalEl = document.getElementById('cart-total');
        const cartCountEl = document.getElementById('cart-count');

        // --- INIT ---
        function init() {
            venues.forEach(v => {
                let opt = document.createElement('option');
                opt.value = v;
                opt.textContent = v;
                venueSelect.appendChild(opt);
            });

            renderMenu();

            guestSelect.addEventListener('change', (e) => {
                currentGuestMultiplier = parseInt(e.target.value);
                updateAllDisplayedPrices();
                if (waitersEnabled) updateWaiterDisplay();
                renderCart();
            });

            searchInput.addEventListener('input', applyFilters);
            typeFilter.addEventListener('change', applyFilters);

            gsap.registerPlugin(ScrollTrigger);
            gsap.from('.fade-in-up', { y: 30, duration: 1, stagger: 0.2, ease: 'power3.out' });

            setupScrollSpy();
        }

        // --- RENDER ---
        function renderMenu() {
            menuContainer.innerHTML = '';

            menuData.forEach((category) => {
                let sectionHTML = `
                    <section id="${category.id}" class="mb-10 md:mb-24 pt-6 menu-section">
                        <h2 class="font-serif text-4xl md:text-5xl text-charcoal font-bold mb-10 border-b-4 border-gold pb-4">${category.categoryTitle}</h2>
                `;

                category.subcategories.forEach(sub => {
                    let tagType = sub.title.toLowerCase();
                    if (tagType.includes('main')) tagType = 'mains';
                    else if (tagType.includes('starter')) tagType = 'starters';
                    else if (tagType.includes('side')) tagType = 'sides';
                    else if (tagType.includes('dessert')) tagType = 'desserts';
                    else if (tagType.includes('special')) tagType = 'specials';
                    else if (category.id === 'cat-canapes') tagType = 'canapés';

                    sectionHTML += `
                        <div class="mb-8 md:mb-14 subcategory-block">
                            <h3 class="font-sans text-xs font-light uppercase tracking-[0.2em] text-gold mb-6">${sub.title}</h3>
                            <div class="flex flex-col">
                    `;

                    sub.items.forEach(item => {
                        const escapedItem = item.replace(/\\/g, '\\\\').replace(/'/g, "\\'");

                        sectionHTML += `
                            <div class="group flex justify-between items-center py-5 border-b border-charcoal/10 hover:bg-sand/60 transition-colors px-4 -mx-4 menu-item-row" data-title="${item.toLowerCase()}" data-type="${tagType}">
                                <div class="pr-6">
                                    <h4 class="font-serif text-xl md:text-2xl text-charcoal font-medium leading-snug">${item}</h4>
                                    <p class="font-sans font-medium text-sm text-charcoal mt-1">Est. £<span class="price-display font-medium text-charcoal" data-base="${sub.basePrice}">${sub.basePrice * currentGuestMultiplier}</span> based on guest count</p>
                                </div>
                                <button onclick="addToCart('${escapedItem}', ${sub.basePrice})" class="w-10 h-10 shrink-0 border border-charcoal/40 text-charcoal/60 rounded-full flex items-center justify-center hover:border-gold hover:text-gold transition-all duration-300 text-xl font-medium focus:outline-none">
                                    +
                                </button>
                            </div>
                        `;
                    });

                    sectionHTML += `</div></div>`;
                });

                sectionHTML += `</section>`;
                menuContainer.innerHTML += sectionHTML;
            });

            gsap.utils.toArray('.menu-section').forEach(section => {
                gsap.from(section, {
                    y: 40, duration: 0.8,
                    scrollTrigger: { trigger: section, start: "top 80%" }
                });
            });
        }

        // --- FILTERING ---
        function applyFilters() {
            const query = searchInput.value.toLowerCase().trim();
            const selectedType = typeFilter.value.toLowerCase();
            let totalVisibleItems = 0;

            document.querySelectorAll('.menu-item-row').forEach(row => {
                const title = row.getAttribute('data-title');
                const type = row.getAttribute('data-type');

                const matchesSearch = title.includes(query);
                const matchesType = selectedType === 'all' || type.includes(selectedType);

                if (matchesSearch && matchesType) {
                    row.style.display = 'flex';
                    totalVisibleItems++;
                } else {
                    row.style.display = 'none';
                }
            });

            document.querySelectorAll('.subcategory-block').forEach(sub => {
                const visibleItems = sub.querySelectorAll('.menu-item-row[style="display: flex;"]');
                sub.style.display = visibleItems.length > 0 ? 'block' : 'none';
            });

            document.querySelectorAll('.menu-section').forEach(sec => {
                const visibleSubs = sec.querySelectorAll('.subcategory-block[style="display: block;"]');
                sec.style.display = visibleSubs.length > 0 ? 'block' : 'none';
            });

            if (totalVisibleItems === 0) {
                menuContainer.classList.add('hidden');
                noResultsMsg.classList.remove('hidden');
                noResultsMsg.classList.add('flex');
            } else {
                menuContainer.classList.remove('hidden');
                noResultsMsg.classList.add('hidden');
                noResultsMsg.classList.remove('flex');
            }

            ScrollTrigger.refresh();
        }

        window.clearFilters = function() {
            searchInput.value = '';
            typeFilter.value = 'all';
            applyFilters();
        };

        function updateAllDisplayedPrices() {
            document.querySelectorAll('.price-display').forEach(el => {
                const base = parseInt(el.getAttribute('data-base'));
                el.textContent = (base * currentGuestMultiplier).toLocaleString();
            });
        }

        // --- CART ---
        let cartExpanded = false;

        const aiBtn = document.getElementById('ai-voice-btn');
        const isMobile = () => window.innerWidth < 768;

        function updateAiBtnPosition() {
            if (!isMobile()) { aiBtn.style.bottom = ''; return; }
            if (cart.length === 0) {
                aiBtn.style.bottom = '1.5rem';
            } else {
                aiBtn.style.bottom = (cartDrawer.offsetHeight + 12) + 'px';
            }
        }

        window.addToCart = function(title, basePrice) {
            cart.push({ title, basePrice });

            if (cart.length === 1) {
                cartDrawer.style.transform = 'translateY(0)';
            }

            renderCart();
            updateAiBtnPosition();
            gsap.fromTo(cartCountEl, { scale: 1.3 }, { scale: 1, duration: 0.3, ease: "back.out(1.7)" });
        };

        window.removeFromCart = function(title) {
            cart = cart.filter(item => item.title !== title);
            if (cart.length === 0 && !waitersEnabled) {
                cartDrawer.style.transform = 'translateY(150%)';
                cartExpanded = false;
                document.getElementById('cart-body').classList.add('hidden');
                document.getElementById('cart-arrow').classList.add('rotate-180');
            }
            renderCart();
            updateAiBtnPosition();
        };

        window.toggleCartExpand = function() {
            const body = document.getElementById('cart-body');
            const arrow = document.getElementById('cart-arrow');
            cartExpanded = !cartExpanded;
            body.classList.toggle('hidden', !cartExpanded);
            arrow.classList.toggle('rotate-180', !cartExpanded);
            // Wait for DOM to render new height before repositioning
            requestAnimationFrame(updateAiBtnPosition);
        };

        function renderCart() {
            cartCountEl.textContent = `${cart.length} item${cart.length !== 1 ? 's' : ''}`;

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p class="text-cream/40 italic text-xs py-2">No dishes selected yet.</p>';
                cartTotalEl.textContent = '£0';
                document.getElementById('cart-total-mini').textContent = '£0';
                return;
            }

            // Group by title
            const grouped = {};
            cart.forEach(item => {
                if (grouped[item.title]) {
                    grouped[item.title].qty++;
                } else {
                    grouped[item.title] = { ...item, qty: 1 };
                }
            });

            let html = '';
            let total = 0;

            Object.values(grouped).forEach(item => {
                const itemTotal = item.basePrice * currentGuestMultiplier * item.qty;
                total += itemTotal;
                html += `
                    <div class="flex justify-between items-center border-b border-cream/10 py-2.5">
                        <div class="pr-3 flex items-center gap-2 min-w-0">
                            ${item.qty > 1 ? `<span class="font-sans text-[10px] font-bold bg-gold text-charcoal px-1.5 py-0.5 rounded-sm shrink-0">x${item.qty}</span>` : ''}
                            <div class="min-w-0">
                                <p class="font-serif text-sm font-light leading-tight text-cream truncate">${item.title}</p>
                                <p class="font-sans text-xs font-light text-gold/80 mt-0.5">£${itemTotal.toLocaleString()}</p>
                            </div>
                        </div>
                        <button onclick="removeFromCart('${item.title.replace(/'/g, "\\'")}')" class="text-cream/40 hover:text-white text-xl leading-none focus:outline-none shrink-0">&times;</button>
                    </div>
                `;
            });

            // Waiter line item
            if (waitersEnabled) {
                const waiterCost = getWaiterCost();
                const waiterCount = waiterCountByGuest[currentGuestMultiplier] || 1;
                total += waiterCost;
                html += `
                    <div class="flex justify-between items-center border-b border-cream/10 py-2.5">
                        <div class="pr-3 min-w-0">
                            <p class="font-serif text-sm font-light leading-tight text-cream">${waiterCount} Waiter${waiterCount !== 1 ? 's' : ''}</p>
                            <p class="font-sans text-xs font-light text-gold/80 mt-0.5">${waiterCost === 0 ? 'Included free' : '£' + waiterCost.toLocaleString()}</p>
                        </div>
                        <button onclick="toggleWaiters()" class="text-cream/40 hover:text-white text-xl leading-none focus:outline-none shrink-0">&times;</button>
                    </div>
                `;
            }

            cartItemsContainer.innerHTML = html;
            cartTotalEl.textContent = `£${total.toLocaleString()}`;
            document.getElementById('cart-total-mini').textContent = `£${total.toLocaleString()}`;
        }

        // --- WAITERS ---
        window.toggleWaiters = function() {
            waitersEnabled = !waitersEnabled;
            const toggle = document.getElementById('waiter-toggle');
            const knob = document.getElementById('waiter-knob');
            const options = document.getElementById('waiter-options');
            const label = document.getElementById('waiter-label');

            if (waitersEnabled) {
                toggle.style.backgroundColor = '#C5A059';
                knob.style.transform = 'translateX(1.5rem)';
                options.classList.remove('hidden');
                label.textContent = 'Service included';
                label.style.color = '#C5A059';
                updateWaiterDisplay();
                if (cart.length === 0) cartDrawer.style.transform = 'translateY(0)';
            } else {
                toggle.style.backgroundColor = 'rgba(28,28,28,0.15)';
                knob.style.transform = '';
                options.classList.add('hidden');
                label.textContent = 'Add to your package';
                label.style.color = 'rgba(28,28,28,0.7)';
                if (cart.length === 0) {
                    cartDrawer.style.transform = 'translateY(150%)';
                    cartExpanded = false;
                    document.getElementById('cart-body').classList.add('hidden');
                    document.getElementById('cart-arrow').classList.add('rotate-180');
                }
            }
            renderCart();
            updateAiBtnPosition();
        };

        function updateWaiterDisplay() {
            const count = waiterCountByGuest[currentGuestMultiplier] || 1;
            const cost = getWaiterCost();
            document.getElementById('waiter-count-display').textContent = `${count} waiter${count !== 1 ? 's' : ''}`;
            document.getElementById('waiter-min-note').textContent = cost === 0
                ? 'Included free for up to 20 guests'
                : `${count} waiters for your guest tier`;
            document.getElementById('waiter-subtotal').textContent = cost === 0 ? 'Free' : `£${cost.toLocaleString()}`;
        }

        // --- AI VOICE CLIENT TOOLS ---
        window.VOICE_CLIENT_TOOLS = {

            // Add a dish to the cart
            add_menu_item: function(p) {
                try {
                    var name  = String(p.name || p.item || '');
                    var price = parseFloat(p.base_price || p.price) || 0;
                    if (typeof addToCart === 'function') addToCart(name, price);
                    return 'Added ' + name + ' to your selection.';
                } catch (e) {
                    console.error('[Voice] add_menu_item:', e);
                    return 'I could not add that item right now — please try again.';
                }
            },

            // Remove a dish from the cart (fuzzy match on title)
            remove_menu_item: function(p) {
                try {
                    var query = String(p.name || p.item || '').toLowerCase();
                    var match = cart.find(function(i) {
                        return i.title.toLowerCase().includes(query) || query.includes(i.title.toLowerCase());
                    });
                    if (match) {
                        removeFromCart(match.title);
                        return 'Removed ' + match.title + ' from your selection.';
                    }
                    return '"' + String(p.name || p.item) + '" was not found in your selection.';
                } catch (e) {
                    console.error('[Voice] remove_menu_item:', e);
                    return 'I could not remove that item right now — please try again.';
                }
            },

            // Change the guest count dropdown to the correct tier
            set_guest_count: function(p) {
                try {
                    var count  = parseInt(p.count || p.guests) || 0;
                    var tiers  = [10, 20, 30, 50, 100, 200, 300];
                    var tier   = tiers.find(function(t) { return count <= t; }) || 300;
                    var select = document.getElementById('guest-count');
                    if (select) {
                        select.value = String(tier);
                        select.dispatchEvent(new Event('change'));
                    }
                    return 'Guest count updated to ' + count + ' guests.';
                } catch (e) {
                    console.error('[Voice] set_guest_count:', e);
                    return 'I could not update the guest count right now — please try again.';
                }
            },

            // Set the venue dropdown to the closest match
            set_venue: function(p) {
                try {
                    var requested = String(p.name || p.venue || '').toLowerCase();
                    var select    = document.getElementById('venue-select');
                    if (!select) return 'Could not update venue.';
                    var options = Array.from(select.options);
                    var match = options.find(function(o) {
                        if (!o.value) return false;
                        var val = o.value.toLowerCase();
                        return val.includes(requested) || requested.includes(val.split(' ')[0]);
                    });
                    if (match) {
                        select.value = match.value;
                        return 'Venue set to ' + match.value + '.';
                    }
                    return '"' + String(p.name || p.venue) + '" is not in our venue list. Please ask the client to confirm the venue name.';
                } catch (e) {
                    console.error('[Voice] set_venue:', e);
                    return 'I could not update the venue right now — please try again.';
                }
            },

            // Enable or disable waiter service
            set_waiters: function(p) {
                try {
                    var wantWaiters = p.enabled === true || p.enabled === 'true';
                    if (wantWaiters && !waitersEnabled) {
                        toggleWaiters();
                        var count   = waiterCountByGuest[currentGuestMultiplier] || 1;
                        var cost    = getWaiterCost();
                        var costStr = cost === 0 ? 'included free' : '£' + cost.toLocaleString();
                        return count + ' waiter' + (count !== 1 ? 's' : '') + ' added (' + costStr + ').';
                    } else if (!wantWaiters && waitersEnabled) {
                        toggleWaiters();
                        return 'Waiter service removed from your package.';
                    }
                    return wantWaiters ? 'Waiter service is already included.' : 'No waiter service selected.';
                } catch (e) {
                    console.error('[Voice] set_waiters:', e);
                    return 'I could not update waiter service right now — please try again.';
                }
            }
        };

        // --- SCROLL SPY ---
        function setupScrollSpy() {
            const sections = document.querySelectorAll('.menu-section');
            const navLinks = document.querySelectorAll('.category-link');

            window.addEventListener('scroll', () => {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (section.style.display !== 'none' && scrollY >= (sectionTop - 250)) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (current && link.getAttribute('href').includes(current)) {
                        link.classList.add('active');
                    }
                });
            });

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    const targetEl = document.getElementById(targetId);
                    if (targetEl && targetEl.style.display !== 'none') {
                        window.scrollTo({ top: targetEl.offsetTop - 120, behavior: 'smooth' });
                    }
                });
            });
        }

        // --- VOICE SPOTLIGHT — scroll + golden glow when Elizabeth mentions a dish ---
        (function () {
            var _cooldown = false;

            // Common English words that aren't food — filtered out before matching
            var SKIP = new Set([
                'that','this','with','your','from','have','just','been','will','here',
                'like','also','them','they','into','more','some','take','make','sure',
                'feel','free','each','then','when','what','which','about','great',
                'added','removed','perfect','noted','wonderful','could','would','please',
                'right','away','love','enjoy','choose','select','option','include',
                'guest','event','price','order','menu','dish','food','item','course',
                'service','package','invoice','email','phone','contact','name','time',
                'start','well','want','need','help','hear','tell','know','going','send'
            ]);

            window.VOICE_ON_AGENT_RESPONSE = function (text) {
                if (!text || _cooldown) return;

                // Extract unique significant words from what Elizabeth said
                var words = Array.from(new Set(
                    text.toLowerCase()
                        .replace(/[^a-z\s]/g, ' ')
                        .split(/\s+/)
                        .filter(function (w) { return w.length >= 4 && !SKIP.has(w); })
                ));
                if (!words.length) return;

                // Score each visible menu row by how many speech words appear in its title
                var best = null, bestScore = 0;
                document.querySelectorAll('.menu-item-row').forEach(function (row) {
                    if (row.style.display === 'none') return;
                    var title = row.getAttribute('data-title') || '';
                    var score = 0;
                    words.forEach(function (w) { if (title.includes(w)) score++; });
                    if (score > bestScore) { bestScore = score; best = row; }
                });

                if (!best || bestScore === 0) return;

                _cooldown = true;

                // Scroll the row to ~35% from the top of the viewport
                var top = best.getBoundingClientRect().top + window.scrollY
                          - Math.round(window.innerHeight * 0.35);
                window.scrollTo({ top: Math.max(0, top), behavior: 'smooth' });

                // Restart the CSS animation (remove → reflow → re-add)
                best.classList.remove('menu-item-spotlight');
                void best.offsetWidth;
                best.classList.add('menu-item-spotlight');

                setTimeout(function () { _cooldown = false; }, 1500);
            };
        })();

        document.addEventListener('DOMContentLoaded', init);

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const isOpen = !menu.classList.contains('pointer-events-none');
            menu.classList.toggle('opacity-0', isOpen);
            menu.classList.toggle('pointer-events-none', isOpen);
        }
    </script>
    <script src="js/voice.js"></script>

    <!-- Footer -->
    <footer class="bg-charcoal text-cream pb-12 pt-6 border-t border-gold/20">
        <div class="max-w-7xl mx-auto px-6 lg:px-12 text-center flex flex-col items-center">
            <img src="images/logo-dark-bg.svg" class="h-12 w-auto mb-6" alt="De'Osa">
            <div class="flex gap-6 mb-8 font-sans text-xs uppercase tracking-widest font-bold">
                <a href="#" class="hover:text-gold transition-colors">Instagram</a>
                <a href="#" class="hover:text-gold transition-colors">Facebook</a>
                <a href="#" class="hover:text-gold transition-colors">Pinterest</a>
            </div>
            <p class="font-sans text-[10px] tracking-widest uppercase text-cream/40">© 2026 De'Osa Catering & Events. All Rights Reserved.</p>
        </div>
    </footer>
</body>
</html>
